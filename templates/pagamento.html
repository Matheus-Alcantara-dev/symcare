{% extends "base.html" %} {% block title %}SymCare - Pagamento{% endblock %} {%
block content %}
<div class="container main-container">
  {% if medicamento and preco %}
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">
            <i class="fas fa-shopping-cart"></i> Finalizar Compra
          </h3>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="medication-card">
                <img
                  src="https://via.placeholder.com/300x200?text={{ medicamento|urlencode }}"
                  class="medication-image"
                  alt="{{ medicamento }}"
                />
                <div class="medication-info">
                  <h4 class="medication-name">{{ medicamento }}</h4>
                  <p class="medication-price">R$ {{ "%.2f"|format(preco) }}</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="payment-summary">
                <h5 class="mb-4">Resumo do Pedido</h5>
                <div class="d-flex justify-content-between mb-2">
                  <span>Subtotal:</span>
                  <span>R$ {{ "%.2f"|format(preco) }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>Taxa de Entrega:</span>
                  <span>Grátis</span>
                </div>
                <hr />
                <div class="d-flex justify-content-between mb-2">
                  <strong>Total:</strong>
                  <strong>R$ {{ "%.2f"|format(preco) }}</strong>
                </div>
              </div>
            </div>
          </div>

          <form id="formPagamento" class="mt-4">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="nome">Nome no Cartão</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-user"></i
                    ></span>
                  </div>
                  <input type="text" class="form-control" id="nome" required />
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="cpf">CPF</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-id-card"></i
                    ></span>
                  </div>
                  <input type="text" class="form-control" id="cpf" required />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12 mb-3">
                <label for="cartao">Número do Cartão</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-credit-card"></i
                    ></span>
                  </div>
                  <input
                    type="text"
                    class="form-control"
                    id="cartao"
                    required
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="validade">Validade</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-calendar"></i
                    ></span>
                  </div>
                  <input
                    type="text"
                    class="form-control"
                    id="validade"
                    placeholder="MM/AA"
                    required
                  />
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="cvv">CVV</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-lock"></i
                    ></span>
                  </div>
                  <input type="text" class="form-control" id="cvv" required />
                </div>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-md-6">
                <a href="/" class="btn btn-secondary btn-block">
                  <i class="fas fa-arrow-left"></i> Voltar às Compras
                </a>
              </div>
              <div class="col-md-6">
                <button type="submit" class="btn btn-custom btn-block">
                  <i class="fas fa-check"></i> Finalizar Compra
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Sucesso -->
  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">
            <i class="fas fa-check-circle"></i> Compra Realizada com Sucesso!
          </h5>
        </div>
        <div class="modal-body text-center">
          <i
            class="fas fa-check-circle text-success"
            style="font-size: 4rem"
          ></i>
          <h4 class="mt-3">Obrigado pela sua compra!</h4>
          <p>
            Seu medicamento está disponível para retirada no balcão de
            atendimento.
          </p>
          <p>
            Apresente o código:
            <strong>{{ range(1000, 9999) | random }}</strong>
          </p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-custom"
            onclick="window.location.href='/'"
          >
            Voltar para o Início
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document
      .getElementById("formPagamento")
      .addEventListener("submit", function (e) {
        e.preventDefault();
        $("#successModal").modal("show");
      });

    // Máscara para CPF
    $("#cpf").on("input", function () {
      let value = $(this).val().replace(/\D/g, "");
      if (value.length <= 11) {
        value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
        $(this).val(value);
      }
    });

    // Máscara para cartão
    $("#cartao").on("input", function () {
      let value = $(this).val().replace(/\D/g, "");
      value = value.replace(/(\d{4})(\d{4})(\d{4})(\d{4})/, "$1 $2 $3 $4");
      $(this).val(value);
    });

    // Máscara para validade
    $("#validade").on("input", function () {
      let value = $(this).val().replace(/\D/g, "");
      if (value.length <= 4) {
        value = value.replace(/(\d{2})(\d{2})/, "$1/$2");
        $(this).val(value);
      }
    });

    // Máscara para CVV
    $("#cvv").on("input", function () {
      let value = $(this).val().replace(/\D/g, "");
      if (value.length <= 3) {
        $(this).val(value);
      }
    });
  </script>
  {% else %}
  <div class="alert alert-warning">
    <i class="fas fa-exclamation-triangle"></i>
    Nenhum medicamento selecionado para pagamento.
    <a href="/" class="alert-link">Voltar para a página inicial</a>
  </div>
  {% endif %}
</div>
{% endblock %}
